{
	"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"SQLVMAdminUsername": {
			"type": "String",
			"defaultValue": "sqladmin",
			"metadata": {
				"description": "The admin user name of the VM"
			}
		},
		"SQLVMAdminPassword": {
			"type": "SecureString",
			"defaultValue": "ThisIsMyLongPassWord99!!",
			"metadata": {
				"description": "The admin password of the VM"
			}
		},
		"MIAdminUserName": {
			"type": "string",
			"defaultValue": "sqladmin",
			"metadata": {
				"description": "Enter the admin user name for the Managed Instance."
			}
		},
		"MIAdminLoginPassword": {
			"type": "secureString",
			"defaultValue": "ThisIsMyLongPassWord99!!",
			"minLength": 16,
			"metadata": {
				"description": "Enter the password for the Managed Instance admin user."
			}
		}		
	},
	"variables": {
		"uniquesuffix": "[uniqueString(guid(subscription().subscriptionId),subscription().subscriptionId, guid(subscription().subscriptionId))]",
		"rgLocation": "[resourceGroup().location]",
		"rgName":  "[resourceGroup().name]",
		"MIrgLocation":  "[resourceGroup().location]",
		"MIrgName": "[toLower(concat(variables('uniquesuffix'),'-MI-'))]",
		"virtualMachineName": "[toLower(concat('sqlvm','-',variables('uniquesuffix')))]",
		"sqlDataDisksCount": 1,
		"SQLDataPath": "F:\\SQLData",
		"SQLLogDisksCount":  1,
		"SQLLogPath":  "G:\\SQLLog",
		"MIsubnetName": "SQLMISubnet",
		"MIsubnetPrefix":  "10.0.0.0/24",
		"MIskuName": "GP_Gen5",
		"MIvCores": 16,
		"MIstorageSizeInGB": 256,
		"MIlicenseType": "LicenseIncluded",
		"DMSserviceName": "IaaStoMIDMSService",
		"DMSlocation": "[resourceGroup().location]",
		"DMSvnetName": "DMSVNet1",
		"DMSsubnetName": "DMSSubnet1",
		"VMImageOffer": "sql2019-ws2019",
		"sqlSku": "Standard",
		"storageWorkloadType": "General",
		"vnetName":  "sqliaasvnet1",
		"vnetAddressPrefix": "10.0.0.0/16",
		"subnetPrefix": "10.0.0.0/24",
		"subnetName": "sqliaassubnet1",
		"SQLVirtualMachineSize": "Standard_D8s_v3",
		"MIInstanceName": "[toLower(concat('sqlmidms',variables('uniquesuffix')))]",
		"MIlocation": "[resourceGroup().location]",
		"MIvirtualNetworkName":"SQLMI-VNET",
		"MIaddressPrefix": "10.0.0.0/16"
	},
	"resources": [
		{

			"type": "Microsoft.Storage/storageAccounts",
			"apiVersion": "2021-06-01",
			"name": "[substring(toLower(concat('dmsstorageaccount', variables('uniquesuffix'))),0,22)]",
			"location": "[variables('rgLocation')]",
			"sku": {
			"name": "Standard_LRS"
			},
			"kind": "StorageV2",
			"properties": {}
		},
		{
			"type": "Microsoft.Network/virtualNetworks",
			"apiVersion": "2020-06-01",
			"name": "[variables('vnetName')]",
			"location": "[variables('rgLocation')]",
			"properties": {
				"addressSpace": {
					"addressPrefixes": [
						"[variables('vnetAddressPrefix')]"
					]
				},
				"subnets": [
					{
						"name": "[variables('subnetName')]",
						"properties": {
							"addressPrefix": "[variables('subnetPrefix')]"
						}
					}
				]
			}
		}

		
	],
	"outputs": {}
}